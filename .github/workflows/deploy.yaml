# This workflow checkes if the graph is built
name: Deploy

on:
  workflow_dispatch:
    inputs:
      network:
        description: 'Target network - xdai or rinkeby'
        required: true
        default: 'xdai'
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install The Graph CLI
        run: yarn global add @graphprotocol/graph-cli
      - name: Add The Graph access token
      - run: graph auth --node https://api.thegraph.com/deploy ${{ secrets.SECRET_TOKEN }}
      - name: Install modules
      - run: yarn install
      - name: Install modules
      - run: yarn prepare-xdai
      - name: Build and deploy
        run: yarn codegen
        run: yarn build
        run: graph deploy --node https://api.thegraph.com/deploy/ --ipfs https://api.thegraph.com/ipfs/ adamazad/aqua-xdai
